# The Scalable Commutativity Rule:  Designing Scalable Software for Multicore Processors 阅读报告

## 1.论文背景

在多核下，接口的设计与可拓展性有密切的联系。传统的检验多核软件的可拓展性的方法通常需要在实现完软件后才开始验证并多次迭代，作者试图在接口设计阶段就充分考虑可拓展性和操作的可交换性间的关系，利用其是否会产生cache line的争用来判断可交换性，并利用COMMUTER工具来寻找软件设计内部存在的制约可拓展性的因素，推导出为实现，可拓展性应满足的条件，和测试这些条件的测试用例，为多核软件这在设计初期就提供可拓展性的指导，提高了开发效率。



## 2.设计架构及创新点

文章主要贡献之一是SIM可交换性。即在一段 操作序列/历史中，如果不同线程的操作间交叉(interleaving)执行而最后结果和状态一样，则这段历史是可以避免冲突的，也即没有cache的争用，可以开发并行性。通过找到一组特定的条件使得满足SIM交换性后，则比存在保证可拓展性的实现。

通过利用SIM 交换性的启发性，作者在设计接口时提供了建议。首先是分解复合操作。 POSIX API通常组合包含不可交换的几个子操作。如果可能，这些操作应该分开。第二个是确保规范非确定性，这允许较少的同步和发挥更多的并发性。第三，许多接口操作限制了必须采用严格排序，在当弱有序就能满足应用需求是限制了可拓展性。最后，异步释放资源意味着昂贵的同步可以被放弃，并且可以再次改善交换性。

本文最后的主要贡献是COMMUTER系统。该系统允许开发人员在实现过程之前指定接口， COMMUTER通过抽象接口的定义，用符号执行的方法寻找能满足可交换性的条件，并生成测试用例测试是否满足可交换性，这些都能指导开发者实现可拓展性的关键点，最后系统还能对实际实现进行测试，判断不同操作间是否有冲突。



## 3.实验


作MTRACE工具识别出，在13,664个Linux测试用例中，只有9,389个是无冲突的。在许多情况下，公共引用计数器是主要原因。为了改善这一点，他们的sv6内核使用COMMUTER系统进行了修改后，13,528个相同的测试用例能实现避免冲突。
此外，还进行了实际运行测试以确定实际的拓展性改善。使用sv6系统，statbench和openbench都表明新的可交换API比传统的Linux版本更具可扩展性。